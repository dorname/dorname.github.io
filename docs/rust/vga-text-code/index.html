<!DOCTYPE html>
<html>
  <head>
    
    <title>走读Writing an OS in Rust实验（四） | Keep learning and trying</title>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    
      
        <link
          rel="stylesheet alternate"
          
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          
          id="default"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/cerulean/bootstrap.min.css"
          
          id="cerulean"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/cosmo/bootstrap.min.css"
          
          id="cosmo"
          class="alternate"
        >
      
        <link
          rel="stylesheet"
          
          href="https://bootswatch.com/5/cyborg/bootstrap.min.css"
          
          id="cyborg"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/darkly/bootstrap.min.css"
          
          id="darkly"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/flatly/bootstrap.min.css"
          
          id="flatly"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/journal/bootstrap.min.css"
          
          id="journal"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/litera/bootstrap.min.css"
          
          id="litera"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/lumen/bootstrap.min.css"
          
          id="lumen"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/lux/bootstrap.min.css"
          
          id="lux"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/materia/bootstrap.min.css"
          
          id="materia"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/minty/bootstrap.min.css"
          
          id="minty"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/morph/bootstrap.min.css"
          
          id="morph"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/pulse/bootstrap.min.css"
          
          id="pulse"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/quartz/bootstrap.min.css"
          
          id="quartz"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/sandstone/bootstrap.min.css"
          
          id="sandstone"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/simplex/bootstrap.min.css"
          
          id="simplex"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/sketchy/bootstrap.min.css"
          
          id="sketchy"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/slate/bootstrap.min.css"
          
          id="slate"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/solar/bootstrap.min.css"
          
          id="solar"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/spacelab/bootstrap.min.css"
          
          id="spacelab"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/superhero/bootstrap.min.css"
          
          id="superhero"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/united/bootstrap.min.css"
          
          id="united"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/vapor/bootstrap.min.css"
          
          id="vapor"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/yeti/bootstrap.min.css"
          
          id="yeti"
          class="alternate"
        >
      
        <link
          rel="stylesheet alternate"
          
          href="https://bootswatch.com/5/zephyr/bootstrap.min.css"
          
          id="zephyr"
          class="alternate"
        >
      
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <script src="https://dorname.github.io/js/topic.js"></script>
    
    
    <script src="https://dorname.github.io/js/theme.js"></script>
    
    
    <script src="https://dorname.github.io/js/scheme.js"></script>
    
    <script src="https://dorname.github.io/js/blockquote.js"></script>
    <script src="https://dorname.github.io/js/img.js"></script>
    
    <script defer src="https://dorname.github.io/elasticlunr.min.js"></script>
    <script defer src="https://dorname.github.io/search_index.en.js"></script>
    <script src="https://dorname.github.io/js/search.js"></script>
    
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>    
    <!-- <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>   -->
  </head>
  <body class="d-flex flex-column min-vh-100">
    
      <div class="w-100">
        <img src="https://dorname.github.io/img/banner.jpeg" class="w-100" />
      </div>
    
    
    
    
    <nav class="
      navbar
      navbar-expand-lg
      navbar-dark
      bg-dark
    ">
      <div class="container-fluid">
        <a class="navbar-brand"
          href="https:&#x2F;&#x2F;dorname.github.io&#x2F;"
          title="主页"
        >Keep learning and trying</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarColor02"
          aria-controls="navbarColor02"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarColor02">
          <ul class="navbar-nav me-auto">
            
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="https:&#x2F;&#x2F;dorname.github.io&#x2F;authors"
                >作者</a>
              </li>
            
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="https:&#x2F;&#x2F;dorname.github.io&#x2F;about"
                >关于</a>
              </li>
            
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="https:&#x2F;&#x2F;dorname.github.io&#x2F;tags"
                >相关主题</a>
              </li>
            
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="https:&#x2F;&#x2F;github.com&#x2F;dorname?tab=repositories"
                >Github</a>
              </li>
            
            
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  博客分类
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;rust"
                        onclick="switchTopic('Rust学习')"
                      >Rust学习</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;articles"
                        onclick="switchTopic('未分类博客')"
                      >未分类博客</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;js_learning"
                        onclick="switchTopic('js学习')"
                      >Js学习</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;webAssembly_rust_and_extJs-lab"
                        onclick="switchTopic('Extjs&#x2F;Rust&#x2F;WASM实验')"
                      >Extjs&#x2F;rust&#x2F;wasm实验</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;blockchain"
                        onclick="switchTopic('区块链')"
                      >区块链</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;mega_git"
                        onclick="switchTopic('Mega')"
                      >Mega</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;distributed_system"
                        onclick="switchTopic('分布式理论')"
                      >分布式理论</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;docker"
                        onclick="switchTopic('Docker容器')"
                      >Docker容器</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;kubernetes"
                        onclick="switchTopic('k8s')"
                      >K8s</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="https:&#x2F;&#x2F;dorname.github.io&#x2F;gradle"
                        onclick="switchTopic('gradle')"
                      >Gradle</a>
                    </li>
                  
                </ul>
              </li>
            
            
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  选择一个主题
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('default')"
                      >Default</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('cerulean')"
                      >Cerulean</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('cosmo')"
                      >Cosmo</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('cyborg')"
                      >Cyborg</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('darkly')"
                      >Darkly</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('flatly')"
                      >Flatly</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('journal')"
                      >Journal</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('litera')"
                      >Litera</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('lumen')"
                      >Lumen</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('lux')"
                      >Lux</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('materia')"
                      >Materia</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('minty')"
                      >Minty</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('morph')"
                      >Morph</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('pulse')"
                      >Pulse</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('quartz')"
                      >Quartz</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('sandstone')"
                      >Sandstone</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('simplex')"
                      >Simplex</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('sketchy')"
                      >Sketchy</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('slate')"
                      >Slate</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('solar')"
                      >Solar</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('spacelab')"
                      >Spacelab</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('superhero')"
                      >Superhero</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('united')"
                      >United</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('vapor')"
                      >Vapor</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('yeti')"
                      >Yeti</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchTheme('zephyr')"
                      >Zephyr</a>
                    </li>
                  
                </ul>
              </li>
            
            
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  选择一个Scheme颜色
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('dark')"
                      >Dark</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('light')"
                      >Light</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('primary')"
                      >Primary</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('primary inverted')"
                      >Primary inverted</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('secondary')"
                      >Secondary</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('secondary inverted')"
                      >Secondary inverted</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('success')"
                      >Success</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('success inverted')"
                      >Success inverted</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('danger')"
                      >Danger</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('danger inverted')"
                      >Danger inverted</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('warning')"
                      >Warning</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('warning inverted')"
                      >Warning inverted</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('info')"
                      >Info</a>
                    </li>
                  
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="switchScheme('info inverted')"
                      >Info inverted</a>
                    </li>
                  
                </ul>
              </li>
            
          </ul>
          
          <form class="d-flex" onsubmit="return goSearch(event)">
            <input
              class="form-control me-sm-2"
              type="text"
              placeholder="搜索"
            />
            <button
              class="btn btn-secondary my-2 my-sm-0"
              type="submit"
            ><i class="fas fa-search"></i></button>
          </form>
          
        </div>
      </div>
    </nav>
    <main class="container mx-auto my-5">
      
  <h1>走读Writing an OS in Rust实验（四）</h1>
  <p class="text-muted">
    
  
  
    
    <a
      class="text-decoration-none text-reset"
      href="https://dorname.github.io/authors/liguangqiao/"
      title="Li Guangqiao"
    ><b>Li Guangqiao</b></a>
   - 
  07&#x2F;12&#x2F;2023

  </p>
  
  <p>
    
      <a
        href="https://dorname.github.io/tags/rust/"
        class="badge bg-dark text-decoration-none link-light me-1"
      >
        Rust
      </a>
    
  </p>
  
  <div class="content">
    <h1 id="vgawen-ben-mo-shi">VGA文本模式</h1>
<p><a href="https://os.phil-opp.com/vga-text-mode/#the-vga-text-buffer">参考原作者phil的官方博客</a></p>
<p>目标：<strong>VGA</strong>文本模式将字符打印到屏幕上，要实现此目标需要将字符写入到VGA硬件的文本缓冲区。VGA文本缓冲区是一个二维数组，通常有25行和80列，直接呈现到屏幕上。每个数组条目通过以下格式描述单个屏幕字符：</p>
<table><thead><tr><th>位</th><th>值</th></tr></thead><tbody>
<tr><td>0-7</td><td>ASCII码</td></tr>
<tr><td>8-11</td><td>前景色</td></tr>
<tr><td>12-14</td><td>背景色</td></tr>
<tr><td>15</td><td>闪烁位</td></tr>
</tbody></table>
<p>第一个字节表示应以 <a href="https://en.wikipedia.org/wiki/ASCII">ASCII 编码</a>打印的字符。更具体地说，它并不完全是 ASCII，而是一个名为代码<a href="https://en.wikipedia.org/wiki/Code_page_437"><em>页 437</em></a> 的字符集，其中包含一些附加字符和轻微修改。为简单起见，我们将在这篇文章中继续称其为 ASCII 字符。第二个字节定义字符的显示方式。前四位定义前景色，后三位定义背景色，最后一位定义字符是否应该闪烁。</p>
<table><thead><tr><th>数值位</th><th>颜色</th><th>数值位+明亮位</th><th>亮色</th></tr></thead><tbody>
<tr><td>0x0</td><td>Black</td><td>0x8</td><td>Dark Gray</td></tr>
<tr><td>0x1</td><td>Blue</td><td>0x9</td><td>Light Blue</td></tr>
<tr><td>0x2</td><td>Green</td><td>0xa</td><td>Light Green</td></tr>
<tr><td>0x3</td><td>Cyan</td><td>0xb</td><td>Light Cyan</td></tr>
<tr><td>0x4</td><td>Red</td><td>0xc</td><td>Light Red</td></tr>
<tr><td>0x5</td><td>Magenta</td><td>0xd</td><td>Pink</td></tr>
<tr><td>0x6</td><td>Brown</td><td>0xe</td><td>Yellow</td></tr>
<tr><td>0x7</td><td>Light Gray</td><td>0xf</td><td>White</td></tr>
</tbody></table>
<p>明亮位是高4位，对于前景色是色调变亮；对于背景色则是用作闪烁位</p>
<p>VGA 文本缓冲区可通过<a href="https://en.wikipedia.org/wiki/Memory-mapped_I/O">内存映射的 I/O</a> 访问地址。这意味着对该地址的读取和写入不会访问 RAM，而是直接访问 VGA 硬件上的文本缓冲区。这意味着我们可以通过正常的内存操作读取和写入该地址<code>0xb8000</code></p>
<p>请注意，内存映射硬件可能不支持所有正常的 RAM 操作。例如，设备只能支持按字节读取，并在读取 a 时返回垃圾。幸运的是，文本缓冲区<a href="https://web.stanford.edu/class/cs140/projects/pintos/specs/freevga/vga/vgamem.htm#manip">支持正常的读取和写入</a>，因此我们不必以特殊方式处理它<code>u64</code></p>
<h2 id="rust-mo-kuai">Rust 模块</h2>
<p>该模块用来处理字符打印逻辑</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>// in src/main.rs
</span><span>mod vga_buffer;
</span></code></pre>
<p>打印逻辑主要分为以下几步：</p>
<ol>
<li>定义颜色</li>
<li>定义屏幕字符和文本缓冲区</li>
<li>实现打印方法</li>
<li>避免打印操作被编译器优化</li>
<li>实现格式化宏</li>
<li>实现下一行函数</li>
<li>暴露一个全局的接口</li>
<li>实现恐慌的错误提示 </li>
</ol>
<h3 id="ding-yi-yan-se">定义颜色</h3>
<ol>
<li>
<p>枚举颜色</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">allow</span><span>(dead_code)]
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Clone, Copy, PartialEq, Eq)]
</span><span>#[</span><span style="color:#bf616a;">repr</span><span>(u8)]
</span><span style="color:#b48ead;">pub enum </span><span>Color {
</span><span>    Black = </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#65737e;">//00000000
</span><span>    Blue = </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#65737e;">//00000001
</span><span>    Green = </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#65737e;">//00000010
</span><span>    Cyan = </span><span style="color:#d08770;">3</span><span>, </span><span style="color:#65737e;">//00000011
</span><span>    Red = </span><span style="color:#d08770;">4</span><span>,  </span><span style="color:#65737e;">//00000100
</span><span>    Magenta = </span><span style="color:#d08770;">5</span><span>, </span><span style="color:#65737e;">//00000101
</span><span>    Brown = </span><span style="color:#d08770;">6</span><span>, </span><span style="color:#65737e;">//00000110
</span><span>    LightGray = </span><span style="color:#d08770;">7</span><span>, </span><span style="color:#65737e;">//00000111
</span><span>    DarkGray = </span><span style="color:#d08770;">8</span><span>, </span><span style="color:#65737e;">//00001000
</span><span>    LightBlue = </span><span style="color:#d08770;">9</span><span>, </span><span style="color:#65737e;">//00001001
</span><span>    LightGreen = </span><span style="color:#d08770;">10</span><span>, </span><span style="color:#65737e;">//00001010
</span><span>    LightCyan = </span><span style="color:#d08770;">11</span><span>, </span><span style="color:#65737e;">//00001011
</span><span>    LightRed = </span><span style="color:#d08770;">12</span><span>, </span><span style="color:#65737e;">//00001100
</span><span>    Pink = </span><span style="color:#d08770;">13</span><span>, </span><span style="color:#65737e;">//00001101
</span><span>    Yellow = </span><span style="color:#d08770;">14</span><span>, </span><span style="color:#65737e;">//00001110
</span><span>    White = </span><span style="color:#d08770;">15</span><span>, </span><span style="color:#65737e;">//00001111
</span><span>}
</span></code></pre>
<ul>
<li>
<p><code>#[allow(dead_code)]</code>用来禁用未使用枚举元素的警告</p>
</li>
<li>
<p><code>#[repr(u8)]</code> 是 Rust 中的一个属性（attribute），用于指定枚举或结构体的内部表示方式。在这个例子中，<code>#[repr(u8)]</code> 指示编译器使用 8 位无符号整数来表示枚举或结构体的成员。</p>
</li>
</ul>
<p><strong>注意：<code>repr</code> 是 &quot;representation&quot; 的缩写，用于控制数据在内存中的布局。在这里，<code>u8</code> 表示无符号 8 位整数，也就是一个字节的大小；这里之所以使u8的原因是因为Rust年没有u4类型</strong></p>
<p>这里每个颜色将表示成一个8位无符号整数。每个变体分配一个不同的整数值，确定好他们在内存中的布局。使用<code>#[repr(u8)]</code>可以对内存布局进行更精确的控制</p>
<ul>
<li><code>#[derive(Debug, Clone, Copy, PartialEq, Eq)]</code>实现这些特征的目的为了方便打印、赋值、借用和比较</li>
</ul>
</li>
<li>
<p>创建颜色结构体</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Clone, Copy, PartialEq, Eq)]
</span><span>#[</span><span style="color:#bf616a;">repr</span><span>(transparent)]
</span><span style="color:#b48ead;">struct </span><span>ColorCode(</span><span style="color:#b48ead;">u8</span><span>);
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ColorCode {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">new</span><span>(</span><span style="color:#bf616a;">foreground</span><span>: Color, </span><span style="color:#bf616a;">background</span><span>: Color) -&gt; ColorCode {
</span><span>        ColorCode((background as </span><span style="color:#b48ead;">u8</span><span>) &lt;&lt; </span><span style="color:#d08770;">4 </span><span>| (foreground as </span><span style="color:#b48ead;">u8</span><span>))
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>#[repr(transparent)]</code>是 Rust 中的一个属性（attribute），用于表示一个结构体（或枚举）在内存中的布局与其单个字段的布局完全相同。这个属性告诉编译器不要对该类型进行额外的优化，保持与其包含的单个字段的内存表示方式一致。</p>
<p>这里的目标就是保证<code>ColorCode</code>的内存布局与<code>u8</code>保持一致，<code>ColorCode((background as u8) &lt;&lt; 4 | (foreground as u8))</code>左移4位因为文本模式表示颜色时，高位表示背景色，低位表示前景色。</p>
</li>
</ol>
<h3 id="wen-ben-huan-chong-qu">文本缓冲区</h3>
<p>添加结构体表示屏幕字符和文本缓冲区</p>
<ul>
<li>通过<code>ascii_character</code>ASCII码字符位、<code>color_code</code>颜色编码描述屏幕字符。</li>
<li>文本缓冲区直接用一个包装类型Buffer描述，这里的 <code>Buffer</code> 结构体包含一个名为 <code>chars</code> 的字段，该字段是一个二维数组，每个元素是一个 <code>ScreenChar</code> 结构体。通过使用 <code>#[repr(transparent)]</code>，你告诉编译器，在内存中，<code>Buffer</code> 的布局应该与 <code>chars</code> 的布局相同。这意味着 <code>Buffer</code> 结构体在内存中的起始地址就是 <code>chars</code> 的起始地址，没有额外的包装或填充。这通常用于包装类型，以确保对包装类型的访问不会引入额外的开销。在这个例子中，<code>Buffer</code> 可能是一个对二维字符数组的包装，而 <code>#[repr(transparent)]</code> 确保了对 <code>Buffer</code> 实例的访问与对 <code>chars</code> 实例的访问相同。</li>
</ul>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Clone, Copy, PartialEq, Eq)]
</span><span>#[</span><span style="color:#bf616a;">repr</span><span>(C)]
</span><span style="color:#b48ead;">struct </span><span>ScreenChar {
</span><span>    </span><span style="color:#bf616a;">ascii_character</span><span>: </span><span style="color:#b48ead;">u8</span><span>,
</span><span>    </span><span style="color:#bf616a;">color_code</span><span>: ColorCode,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">const </span><span style="color:#d08770;">BUFFER_HEIGHT</span><span>: </span><span style="color:#b48ead;">usize </span><span>= </span><span style="color:#d08770;">25</span><span>;
</span><span style="color:#b48ead;">const </span><span style="color:#d08770;">BUFFER_WIDTH</span><span>: </span><span style="color:#b48ead;">usize </span><span>= </span><span style="color:#d08770;">80</span><span>;
</span><span>
</span><span>#[</span><span style="color:#bf616a;">repr</span><span>(transparent)]
</span><span style="color:#b48ead;">struct </span><span>Buffer {
</span><span>    </span><span style="color:#bf616a;">chars</span><span>: [[ScreenChar; BUFFER_WIDTH]; BUFFER_HEIGHT],
</span><span>}
</span></code></pre>
<p><code>chars: [[ScreenChar; BUFFER_WIDTH]; BUFFER_HEIGHT]</code> 是一个字段声明，它表示一个二维数组，用于存储 <code>ScreenChar</code> 结构体的元素。让我们分解一下这个声明：</p>
<ul>
<li><code>ScreenChar</code> 是一个结构体类型，可能包含了表示屏幕上单个字符的相关信息，比如字符本身、颜色、样式等。</li>
<li><code>BUFFER_WIDTH</code> 和 <code>BUFFER_HEIGHT</code> 是常量或者编译时常量，用来指定二维数组的宽度和高度。这两个常量决定了 <code>chars</code> 字段的大小，也即是 <code>Buffer</code> 结构体的大小。</li>
</ul>
<p>因此，<code>chars</code> 字段是一个二维数组，其中每个元素都是 <code>ScreenChar</code> 类型。这种结构通常用于表示屏幕缓冲区，其中 <code>BUFFER_WIDTH</code> 表示一行上的字符数，<code>BUFFER_HEIGHT</code> 表示屏幕上的行数。</p>
<p><code>#[repr(C)]</code> 是 Rust 中的一个属性（attribute），用于指示结构体或枚举在内存中的布局应该按照 C 语言的规则进行。这个属性主要用于与 C 语言进行交互、与 C ABI（Application Binary Interface）兼容，以及确保 Rust 类型在内存中的布局与 C 类型兼容。</p>
<p>C 语言有一些规则来定义结构体和枚举在内存中的布局，包括字段的排列顺序和对齐方式。使用 <code>#[repr(C)]</code> 属性，Rust 可以尽量按照这些规则来组织内存布局，以便在与 C 语言编写的代码进行交互时，数据的传递和访问是可预测的。</p>
<p>为了实际写入屏幕，我们现在创建一个写入器类型：</p>
<p>写入器包含三个要素：写入的位置、字符颜色和文本缓冲区</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span style="color:#b48ead;">pub struct </span><span>Writer {
</span><span>    </span><span style="color:#bf616a;">column_position</span><span>: </span><span style="color:#b48ead;">usize</span><span>,
</span><span>    </span><span style="color:#bf616a;">color_code</span><span>: ColorCode,
</span><span>    </span><span style="color:#bf616a;">buffer</span><span>: &amp;</span><span style="color:#b48ead;">&#39;static mut</span><span> Buffer,
</span><span>}
</span></code></pre>
<h3 id="da-yin">打印</h3>
<p>如果我们希望使用写入器区改变文本缓冲区的字符数据，需要实现一个单字节ASCII码的写入方法，</p>
<p>这里的打印策略包含以下几种：</p>
<ol>
<li><code>\n</code>换行符进入下一行</li>
<li>其他字节
<ul>
<li>当字节位置大于单行最大字符数时，进入下一行</li>
<li>其他情况，将字节写入写入器的文本缓冲区buffer</li>
</ul>
</li>
</ol>
<p>下面采用模式匹配完成单字节打印函数</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">impl </span><span>Writer {
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">write_byte</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">byte</span><span>: </span><span style="color:#b48ead;">u8</span><span>) {
</span><span>        </span><span style="color:#b48ead;">match</span><span> byte {
</span><span>            </span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#96b5b4;">\n</span><span>&#39; =&gt; </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">new_line</span><span>(),
</span><span>            byte =&gt; {
</span><span>                </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.column_position &gt;= </span><span style="color:#d08770;">BUFFER_WIDTH </span><span>{
</span><span>                    </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">new_line</span><span>();
</span><span>                }
</span><span>
</span><span>                </span><span style="color:#b48ead;">let</span><span> row = </span><span style="color:#d08770;">BUFFER_HEIGHT </span><span>- </span><span style="color:#d08770;">1</span><span>;
</span><span>                </span><span style="color:#b48ead;">let</span><span> col = </span><span style="color:#bf616a;">self</span><span>.column_position;
</span><span>
</span><span>                </span><span style="color:#b48ead;">let</span><span> color_code = </span><span style="color:#bf616a;">self</span><span>.color_code;
</span><span>                </span><span style="color:#bf616a;">self</span><span>.buffer.chars[row][col] = ScreenChar {
</span><span>                    ascii_character: byte,
</span><span>                    color_code,
</span><span>                };
</span><span>                </span><span style="color:#bf616a;">self</span><span>.column_position += </span><span style="color:#d08770;">1</span><span>;
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">new_line</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>) {</span><span style="color:#65737e;">/* TODO */</span><span>}
</span><span>}
</span></code></pre>
<p>为了打印整个字符串，我们可以将其转换成字节序列然后一个个字符打印：</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Writer {
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">write_string</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">s</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) {
</span><span>        </span><span style="color:#b48ead;">for</span><span> byte in s.</span><span style="color:#96b5b4;">bytes</span><span>() {
</span><span>            </span><span style="color:#b48ead;">match</span><span> byte {
</span><span>                </span><span style="color:#65737e;">// printable ASCII byte or newline
</span><span>                </span><span style="color:#d08770;">0x20</span><span>..=</span><span style="color:#d08770;">0x7e </span><span>| </span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#96b5b4;">\n</span><span>&#39; =&gt; </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">write_byte</span><span>(byte),
</span><span>                </span><span style="color:#65737e;">// not part of printable ASCII range
</span><span>                _ =&gt; </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">write_byte</span><span>(</span><span style="color:#d08770;">0xfe</span><span>),
</span><span>            }
</span><span>
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p><strong>注意ASCII 字符范围：</strong> ASCII 字符是一个7位字符集，其中包含了一些控制字符（0x00到0x1F）和一些可打印字符（0x20到0x7E）。这个范围 <code>0x20..=0x7E</code> 正好覆盖了可打印的 ASCII 字符，包括空格（0x20）到波浪号（0x7E）之间的所有字符。 通过使用 <code>0x20..=0x7e</code>，代码有效地过滤了输入字符串中的非可打印 ASCII 字符，只允许这个范围内的字符通过。其他字符将被替换为一个特殊的不可打印字符（0xfe）。</p>
<h3 id="ce-shi-yi-xia-da-yin-gong-neng">测试一下打印功能</h3>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">print_something</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let mut</span><span> writer = Writer {
</span><span>        column_position: </span><span style="color:#d08770;">0</span><span>,
</span><span>        color_code: ColorCode::new(Color::Yellow, Color::Black),
</span><span>        buffer: </span><span style="color:#b48ead;">unsafe </span><span>{ &amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer) },
</span><span>    };
</span><span>
</span><span>    writer.</span><span style="color:#96b5b4;">write_byte</span><span>(</span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#a3be8c;">F</span><span>&#39;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">this</span><span>&quot;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">World!</span><span>&quot;);
</span><span>}
</span></code></pre>
<p><strong><code>buffer: unsafe { &amp;mut \*(0xb8000 as \*mut Buffer) }</code>：</strong> 这个字段是一个指向屏幕缓冲区的可变引用。<code>0xb8000</code> 是标准文本模式下的显存起始地址。通过将其转换为 <code>*mut Buffer</code> 类型，然后用 <code>&amp;mut</code> 取引用，代码创建了一个指向屏幕缓冲区的可变引用。实际上<code>Buffer</code>的内存布局同字段<code>chars</code>是一个二维数组，这里使用了 <code>unsafe</code> 关键字，因为涉及到对原始指针的操作，这可能会导致不安全的行为。</p>
<p>调用<code>print_something</code></p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/main.rs
</span><span>
</span><span>#[</span><span style="color:#bf616a;">no_mangle</span><span>]
</span><span style="color:#b48ead;">pub extern </span><span>&quot;</span><span style="color:#a3be8c;">C</span><span>&quot; </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">_start</span><span>() -&gt; ! {
</span><span>    vga_buffer::print_something();
</span><span>
</span><span>    </span><span style="color:#b48ead;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p><img src="https://dorname.github.io/rust/vga-text-code/./text_one.png" alt="测试结果" /></p>
<p>尝试一下打印一下UTF-8字符</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">print_something</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let mut</span><span> writer = Writer {
</span><span>        column_position: </span><span style="color:#d08770;">0</span><span>,
</span><span>        color_code: ColorCode::new(Color::Yellow, Color::Black),
</span><span>        buffer: </span><span style="color:#b48ead;">unsafe </span><span>{ &amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer) },
</span><span>    };
</span><span>
</span><span>    writer.</span><span style="color:#96b5b4;">write_byte</span><span>(</span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#a3be8c;">F</span><span>&#39;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">this</span><span>&quot;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">World!</span><span>&quot;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">测试</span><span>&quot;)
</span><span>}
</span></code></pre>
<p><img src="https://dorname.github.io/rust/vga-text-code/text_two.png" alt="" /></p>
<p>这是因为它由 <a href="https://www.fileformat.info/info/unicode/utf8.htm">UTF-8</a> 中的两个字节表示，这两个字节都不属于可打印的 ASCII 范围。事实上，这是 UTF-8 的一个基本属性：多字节值的单个字节从来都不是有效的 ASCII。</p>
<h3 id="bi-mian-rustbian-yi-qi-you-hua-da-yin-fang-fa">避免Rust编译器优化打印方法</h3>
<p>问题在于，我们只写入 ，而再也不会从中读取。编译器不知道我们是否真的访问了VGA缓冲内存（而不是普通的RAM），并且对某些字符出现在屏幕上的副作用一无所知。因此，它可能会决定这些写入是不必要的，可以省略。为了避免这种错误的优化，我们需要将这些写入指定为*<a href="https://en.wikipedia.org/wiki/Volatile_(computer_programming)">易失性</a>*。这告诉编译器写入有副作用，不应该优化掉.</p>
<p>处理方案，就是引入<strong>Volatile Lib</strong>，并包裹屏幕字符结构体</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># in Cargo.toml
</span><span>
</span><span>[dependencies]
</span><span>volatile = &quot;0.2.6&quot;
</span></code></pre>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">use </span><span>volatile::Volatile;
</span><span>
</span><span style="color:#b48ead;">struct </span><span>Buffer {
</span><span>    </span><span style="color:#bf616a;">chars</span><span>: [[Volatile&lt;ScreenChar&gt;; BUFFER_WIDTH]; BUFFER_HEIGHT],
</span><span>}
</span></code></pre>
<p>同时屏幕字符写入文本缓冲区的二维数组的时候，已经不能使用<code>=</code>号赋值，当前只能使用<code>write</code>方法写字符</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Writer {
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">write_byte</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">byte</span><span>: </span><span style="color:#b48ead;">u8</span><span>) {
</span><span>        </span><span style="color:#b48ead;">match</span><span> byte {
</span><span>            </span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#96b5b4;">\n</span><span>&#39; =&gt; </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">new_line</span><span>(),
</span><span>            byte =&gt; {
</span><span>                ...
</span><span>
</span><span>                </span><span style="color:#bf616a;">self</span><span>.buffer.chars[row][col].</span><span style="color:#96b5b4;">write</span><span>(ScreenChar {
</span><span>                    ascii_character: byte,
</span><span>                    color_code,
</span><span>                });
</span><span>                ...
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>    ...
</span><span>}
</span></code></pre>
<h3 id="shi-xian-ge-shi-hua-da-yin-hong-write">实现格式化打印宏（write!）</h3>
<p>目标：为内核提供一个格式化宏，方便打印不同类型的数据。</p>
<p>解决方法：实现<code>core::fmt::Write</code>特征</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">use </span><span>core::fmt;
</span><span>
</span><span style="color:#b48ead;">impl </span><span>fmt::Write </span><span style="color:#b48ead;">for </span><span>Writer {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">write_str</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">s</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) -&gt; fmt::Result {
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">write_string</span><span>(s);
</span><span>        Ok(())
</span><span>    }
</span><span>}
</span><span>
</span></code></pre>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">print_something</span><span>(){
</span><span>    </span><span style="color:#b48ead;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#b48ead;">let mut</span><span> writer = Writer{
</span><span>        column_position:</span><span style="color:#d08770;">0</span><span>,
</span><span>        color_code:ColorCode::new(Color::Yellow,Color::Black),
</span><span>        buffer:</span><span style="color:#b48ead;">unsafe</span><span>{&amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer)}
</span><span>    };
</span><span>    writer.</span><span style="color:#96b5b4;">write_byte</span><span>(</span><span style="color:#b48ead;">b</span><span>&#39;</span><span style="color:#a3be8c;">F</span><span>&#39;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">uck this </span><span>&quot;);
</span><span>    writer.</span><span style="color:#96b5b4;">write_string</span><span>(&quot;</span><span style="color:#a3be8c;">World!</span><span style="color:#96b5b4;">\n</span><span>&quot;);
</span><span>    </span><span style="color:#65737e;">//打印UTF-8字符
</span><span>    </span><span style="color:#65737e;">// writer.write_string(&quot;测试&quot;);
</span><span>    write!(writer,&quot;</span><span style="color:#a3be8c;">CN Dota 2018 LGD </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">,</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">,</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">,</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">,</span><span style="color:#d08770;">{}</span><span style="color:#96b5b4;">\n</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">AME</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">Maybe</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">Chalice</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">fy</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">xNove</span><span>&quot;).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    write!(writer, &quot;</span><span style="color:#a3be8c;">Trying find my life goal in </span><span style="color:#d08770;">{}</span><span style="color:#96b5b4;">\n</span><span>&quot;,</span><span style="color:#d08770;">2023</span><span>).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    write!(writer, &quot;</span><span style="color:#a3be8c;">Trying about </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> times</span><span>&quot;,</span><span style="color:#d08770;">100000.0</span><span>/</span><span style="color:#d08770;">3.0</span><span>).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>}
</span></code></pre>
<p><code>cargo run</code>验证</p>
<p><img src="https://dorname.github.io/rust/vga-text-code/text_three.png" alt="" /></p>
<h3 id="shi-xian-xin-zeng-xing-luo-ji">实现新增行逻辑</h3>
<p>实现思路：每个字符向上移动一行，清除最下面一行的内容，回到从最下面一行的第一个字符位重新开始。</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">impl </span><span>Writer {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">new_line</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>) {
</span><span>        </span><span style="color:#b48ead;">for</span><span> row in </span><span style="color:#d08770;">1</span><span>..</span><span style="color:#d08770;">BUFFER_HEIGHT </span><span>{
</span><span>            </span><span style="color:#b48ead;">for</span><span> col in </span><span style="color:#d08770;">0</span><span>..</span><span style="color:#d08770;">BUFFER_WIDTH </span><span>{
</span><span>                </span><span style="color:#b48ead;">let</span><span> character = </span><span style="color:#bf616a;">self</span><span>.buffer.chars[row][col].</span><span style="color:#96b5b4;">read</span><span>();
</span><span>                </span><span style="color:#bf616a;">self</span><span>.buffer.chars[row - </span><span style="color:#d08770;">1</span><span>][col].</span><span style="color:#96b5b4;">write</span><span>(character);
</span><span>            }
</span><span>        }
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">clear_row</span><span>(</span><span style="color:#d08770;">BUFFER_HEIGHT </span><span>- </span><span style="color:#d08770;">1</span><span>);
</span><span>        </span><span style="color:#bf616a;">self</span><span>.column_position = </span><span style="color:#d08770;">0</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">clear_row</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>,</span><span style="color:#bf616a;">row</span><span>:</span><span style="color:#b48ead;">usize</span><span>){
</span><span>        </span><span style="color:#b48ead;">let</span><span> blank = ScreenChar {
</span><span>            ascii_character:</span><span style="color:#b48ead;">b</span><span>&#39; &#39;,
</span><span>            color_code:</span><span style="color:#bf616a;">self</span><span>.color_code
</span><span>        };
</span><span>        </span><span style="color:#b48ead;">for</span><span> col in </span><span style="color:#d08770;">0</span><span>..</span><span style="color:#d08770;">BUFFER_WIDTH</span><span>{
</span><span>            </span><span style="color:#bf616a;">self</span><span>.buffer.chars[row][col].</span><span style="color:#96b5b4;">write</span><span>(blank);
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<h3 id="quan-ju-jie-kou">全局接口</h3>
<p>目标：提供一个全局的打印接口</p>
<p>处理方案：定义一个全局变量<code>WRITER</code></p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">pub static </span><span style="color:#d08770;">WRITER</span><span>: Writer = Writer {
</span><span>    column_position: </span><span style="color:#d08770;">0</span><span>,
</span><span>    color_code: ColorCode::new(Color::Yellow, Color::Black),
</span><span>    buffer: </span><span style="color:#b48ead;">unsafe </span><span>{ &amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer) },
</span><span>};
</span></code></pre>
<p><code>cargo run</code>发现报错，<strong>原因是因为静态标记<code>static</code>内容都是在编译时期初始化的，而不是在运行时初始化的普通内容</strong></p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>error[E0015]: cannot call non-const fn `ColorCode::new` in statics
</span><span>   --&gt; src/vga_buffer.rs:131:16
</span><span>    |
</span><span>131 |     color_code:ColorCode::new(Color::Blue,Color::Black),
</span><span>    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span><span>    |
</span><span>    = note: calls in statics are limited to constant functions, tuple structs and tuple variants
</span><span>    = note: consider wrapping this expression in `Lazy::new(|| ...)` from the `once_cell` crate: https://crates.io/crates/once_cell
</span><span>
</span><span>error[E0658]: dereferencing raw mutable pointers in statics is unstable
</span><span>   --&gt; src/vga_buffer.rs:133:9
</span><span>    |
</span><span>133 |         &amp;mut *(0xb8000 as *mut Buffer)
</span><span>    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span><span>    |
</span><span>    = note: see issue #57349 &lt;https://github.com/rust-lang/rust/issues/57349&gt; for more information
</span><span>    = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable
</span><span>
</span><span>Some errors have detailed explanations: E0015, E0658.
</span><span>For more information about an error, try `rustc --explain E0015`.
</span></code></pre>
<p>处理方案：借用<code>lazy_statics</code>库，它保证静态变量在运行时初始化</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>[dependencies]
</span><span>lazy_static = {version = &quot;1.0&quot;,features = [&quot;spin_no_std&quot;]}
</span></code></pre>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span style="color:#b48ead;">use </span><span>lazy_static::lazy_static;
</span><span>
</span><span>lazy_static!{
</span><span>    </span><span style="color:#b48ead;">pub static ref </span><span style="color:#d08770;">WRITER</span><span>:Writer = Writer {
</span><span>        column_position:</span><span style="color:#d08770;">0</span><span>,
</span><span>        </span><span style="color:#65737e;">//这里为了好玩前景色换成了黑色背景色为猛男粉
</span><span>        color_code:ColorCode::new(Color::Black,Color::Pink),
</span><span>        buffer:</span><span style="color:#b48ead;">unsafe </span><span>{
</span><span>            &amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer)
</span><span>        }
</span><span>    };
</span><span>}
</span></code></pre>
<p>注意：<strong>接口现在仍然是比较鸡肋的，因为<code>WRITER</code>是不可变的变量，这意味着我们无法使用他的打印方法打印内容，简单理解，每次打印我们都需要调整<code>Writer</code>的buffer字段，如果不可变就没有意义</strong></p>
<p>作者提到了两种方案：</p>
<ol>
<li>定义成可变的静态变量，但是这样一来，对它的每次读取和写入都是不安全的，因为它很容易引入数据竞争和其他不好的事情。例如两个线程中同时使用了全局接口，就会引起数据竞争。</li>
<li>可使用<code>RefCell</code>和<code>UnsafeCell</code>来提供内部可变性，但这种方案又不是同步的。</li>
</ol>
<h3 id="zi-xuan-suo">自旋锁</h3>
<p>为了获得同步的内部可变性，标准库的用户可以使用<a href="https://doc.rust-lang.org/nightly/std/sync/struct.Mutex.html">互斥锁</a>。它通过在资源已锁定时阻塞线程来提供互斥。但是我们的基本内核没有任何阻塞支持，甚至没有线程的概念，所以我们也不能使用它。然而，计算机科学中有一种非常基本的互斥锁，它不需要操作系统功能：<a href="https://en.wikipedia.org/wiki/Spinlock">自旋锁</a>。线程没有阻塞，而是简单地尝试在紧密循环中一次又一次地锁定它，从而消耗 CPU 时间，直到互斥锁再次释放。</p>
<p>引入<code>spin crate</code></p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># in Cargo.toml
</span><span>[dependencies]
</span><span>spin = &quot;0.5.2&quot;
</span></code></pre>
<p>然后，我们可以使用旋转互斥锁为<code>WRITER</code>添加安全的<a href="https://doc.rust-lang.org/book/ch15-05-interior-mutability.html">内部可变性</a></p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#b48ead;">use </span><span>spin::Mutex;
</span><span>...
</span><span>lazy_static! {
</span><span>    </span><span style="color:#b48ead;">pub static ref </span><span style="color:#d08770;">WRITER</span><span>: Mutex&lt;Writer&gt; = Mutex::new(Writer {
</span><span>        column_position: </span><span style="color:#d08770;">0</span><span>,
</span><span>        color_code: ColorCode::new(Color::Yellow, Color::Black),
</span><span>        buffer: </span><span style="color:#b48ead;">unsafe </span><span>{ &amp;</span><span style="color:#b48ead;">mut </span><span>*(</span><span style="color:#d08770;">0xb8000 </span><span>as </span><span style="color:#b48ead;">*mut</span><span> Buffer) },
</span><span>    });
</span><span>}
</span></code></pre>
<p>测试：</p>
<p>尝试改变全局接口<code>WRITER</code>中的<code>Writer</code></p>
<ol>
<li><code>vga_buffer::WRITER.lock()</code>获取<code>Writer</code></li>
<li>调用<code>write_str</code>方法测试<code>write_string</code>的打印功能</li>
<li>通过<code>Write</code>的写入宏<code>write!</code>往<code>Writer</code>中写入字符串</li>
</ol>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in src/main.rs
</span><span>#[</span><span style="color:#bf616a;">no_mangle</span><span>]
</span><span style="color:#b48ead;">pub extern </span><span>&quot;</span><span style="color:#a3be8c;">C</span><span>&quot; </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">_start</span><span>() -&gt; ! {
</span><span>    </span><span style="color:#b48ead;">use </span><span>core::fmt::Write;
</span><span>    vga_buffer::</span><span style="color:#d08770;">WRITER</span><span>.</span><span style="color:#96b5b4;">lock</span><span>().</span><span style="color:#96b5b4;">write_str</span><span>(&quot;</span><span style="color:#a3be8c;">Hello again</span><span>&quot;).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    write!(vga_buffer::WRITER.lock(), &quot;</span><span style="color:#a3be8c;">, some numbers: </span><span style="color:#d08770;">{} {}</span><span>&quot;, </span><span style="color:#d08770;">42</span><span>, </span><span style="color:#d08770;">1.337</span><span>).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>
</span><span>    </span><span style="color:#b48ead;">loop </span><span>{}
</span><span>}
</span></code></pre>
<h3 id="an-quan-xing">安全性</h3>
<p>请注意，我们的代码中只有一个不安全块，创建指向 的引用需要它。之后，所有操作都是安全的。默认情况下，Rust 对数组访问使用边界检查，因此我们不会意外地在缓冲区之外写入。因此，我们在类型系统中对所需的条件进行了编码，并能够为外部提供安全的接口。</p>
<h3 id="zhong-xin-shi-xian-da-yin-hong">重新实现打印宏</h3>
<p>处理方案：参考标准库的<code>println</code>宏</p>
<p>标准库的<code>println</code>宏源代码：</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">macro_export</span><span>]
</span><span style="color:#96b5b4;">macro_rules! </span><span>println {
</span><span>    () =&gt; (print!(&quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;));
</span><span>    ($(</span><span style="color:#bf616a;">$arg</span><span>:</span><span style="color:#b48ead;">tt</span><span>)*) =&gt; (print!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#96b5b4;">\n</span><span>&quot;, format_args!($(</span><span style="color:#bf616a;">$arg</span><span>)*)));
</span><span>}
</span></code></pre>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">macro_export</span><span>]
</span><span style="color:#96b5b4;">macro_rules! </span><span>print {
</span><span>    ($(</span><span style="color:#bf616a;">$arg</span><span>:</span><span style="color:#b48ead;">tt</span><span>)*) =&gt; (</span><span style="color:#bf616a;">$crate</span><span>::io::_print(format_args!($(</span><span style="color:#bf616a;">$arg</span><span>)*)));
</span><span>}
</span></code></pre>
<p>宏扩展为对模块中 <a href="https://github.com/rust-lang/rust/blob/29f5c699b11a6a148f097f82eaa05202f8799bbc/src/libstd/io/stdio.rs#L698"><code>_print</code> 函数</a>的调用。<a href="https://doc.rust-lang.org/1.30.0/book/first-edition/macros.html#the-variable-crate"><code>$crate</code> 变量</a>通过扩展到在其他 crate 中使用时，确保宏也能在 crate 外部工作。</p>
<p><a href="https://doc.rust-lang.org/nightly/std/macro.format_args.html"><code>format_args</code>宏</a>从传递的参数构建 <a href="https://doc.rust-lang.org/nightly/core/fmt/struct.Arguments.html"><code>fmt::Arguments</code></a> 类型，该类型将传递给 。libstd 调用的 <a href="https://github.com/rust-lang/rust/blob/29f5c699b11a6a148f097f82eaa05202f8799bbc/src/libstd/io/stdio.rs#L698"><code>_print</code> 函数</a>，由于它支持不同的设备，因此相当复杂。我们不需要这种复杂性，因为我们只想打印到 VGA 缓冲区。</p>
<p>要打印到 VGA 缓冲区，我们只需复制宏过来，修改它们以使用我们自己的函数：<code>println!</code> <code>print!</code> <code>_print</code></p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">macro_export</span><span>]
</span><span style="color:#96b5b4;">macro_rules! </span><span>print {
</span><span>    ($(</span><span style="color:#bf616a;">$arg</span><span>:</span><span style="color:#b48ead;">tt</span><span>)*) =&gt; {
</span><span>        (</span><span style="color:#bf616a;">$crate</span><span>::vga_buffer::_print(format_args!($(</span><span style="color:#bf616a;">$arg</span><span>)*)));
</span><span>    };
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">macro_export</span><span>]
</span><span style="color:#96b5b4;">macro_rules! </span><span>println {
</span><span>    () =&gt; (</span><span style="color:#bf616a;">$crate</span><span>::print!(&quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;));
</span><span>    ($(</span><span style="color:#bf616a;">$arg</span><span>:</span><span style="color:#b48ead;">tt</span><span>)*) =&gt; (</span><span style="color:#bf616a;">$crate</span><span>::print!(&quot;</span><span style="color:#a3be8c;">{}</span><span style="color:#96b5b4;">\n</span><span>&quot;, format_args!($(</span><span style="color:#bf616a;">$arg</span><span>)*)));
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">doc</span><span>(hidden)]
</span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">_print</span><span>(</span><span style="color:#bf616a;">args</span><span>: fmt::Arguments) {
</span><span>    </span><span style="color:#b48ead;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#d08770;">WRITER</span><span>.</span><span style="color:#96b5b4;">lock</span><span>().</span><span style="color:#96b5b4;">write_fmt</span><span>(args).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>}
</span></code></pre>
<p>这里需要理解<code>write_fmt</code>本质上还是在调用<code>write_str</code>方法，均是<code>Write</code>特征中的方法。</p>
<h3 id="bu-chong-kong-huang-xin-xi-da-yin">补充恐慌信息打印</h3>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#65737e;">// in main.rs
</span><span>
</span><span style="color:#65737e;">/// This function is called on panic.
</span><span>#[</span><span style="color:#bf616a;">panic_handler</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">panic</span><span>(</span><span style="color:#bf616a;">info</span><span>: &amp;PanicInfo) -&gt; ! {
</span><span>    println!(&quot;</span><span style="color:#d08770;">{}</span><span>&quot;, info);
</span><span>    </span><span style="color:#b48ead;">loop </span><span>{}
</span><span>}
</span><span>#[</span><span style="color:#bf616a;">no_mangle</span><span>]
</span><span style="color:#b48ead;">pub extern </span><span>&quot;</span><span style="color:#a3be8c;">C</span><span>&quot; </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">_start</span><span>() -&gt; ! {
</span><span>    </span><span style="color:#65737e;">// use core::fmt::Write;
</span><span>    </span><span style="color:#65737e;">// vga_buffer::WRITER.lock().write_str(&quot;Hello again&quot;).unwrap();
</span><span>    </span><span style="color:#65737e;">// vga_buffer::WRITER.lock().write_str(&quot;Hello again again&quot;).unwrap();
</span><span>    </span><span style="color:#65737e;">// write!(vga_buffer::WRITER.lock(), &quot;, some numbers: {} {}&quot;, 42, 1.337).unwrap();
</span><span>    println!(&quot;</span><span style="color:#a3be8c;">Hello World</span><span style="color:#d08770;">{}</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">!</span><span>&quot;);
</span><span>    panic!(&quot;</span><span style="color:#a3be8c;">This is a panic message</span><span>&quot;);
</span><span>    </span><span style="color:#b48ead;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>测试<code>cargo run</code>:</p>
<p><img src="https://dorname.github.io/rust/vga-text-code/text_four.png" alt="" /></p>

  </div>
  
    
  
  <div class="card my-5">
    <div class="row g-0">
      <div class="col-md-4 d-flex align-items-center">
        
  <img
    src="https:&#x2F;&#x2F;dorname.github.io&#x2F;authors&#x2F;liguangqiao&#x2F;harry.jpg"
    class="img-fluid m-auto d-block rounded-circle"
    alt="Li Guangqiao"
  />

      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h5 class="card-title">
            <a
              class="text-decoration-none text-reset"
              href="https://dorname.github.io/authors/liguangqiao/"
            >Li Guangqiao</a>
          </h5>
          <p class="card-text"><p>一个正在转rust的ExtJs前端工程师。迷信rust的整体发展，十分相信rust在各个领域都能发光发热，至少目前rust在很多领域上验证了其安全性、易维护性。但说实话对于我这种菜鸡也是真的难上手哈哈哈~~。
思路总结：</p>
<ul>
<li>万物诞生都会有一个需求来源，每一个改变都是为了解决某个问题，最后应该考虑如何去做</li>
<li>学会掌握一些宏观的知识和理论：系统论、还原论</li>
<li>工程化思想，如何描述整体，从整体架构到模块关联等
故学习东西应该像看地图一样，先看整体了解整体的结构，然后再聚焦每一个模块，对于模块的学习，思考三个问题，“是什么？”、“为什么？”、“怎么做？”；那么设计一个东西时也应该去考虑整体性和关联性。</li>
</ul>
<p>有关于未来的发展，以下是鄙人的粗浅的观点：</p>
<ul>
<li>编程语言未来应该是每个人必备的工具</li>
<li>未来的交互方式应该会以语言交互为主流</li>
<li>下一个去中心化的技术方案出来之前，区块链依然是web3建立价值体系的基础技术方案，如何将现实价值和虚拟价值联通是进入数字世界的一个大难题。</li>
<li>未来注定是AI的世界。AI的进化会伴随绝大部分人的退化，届时除了尖端人才，人们学习的重心会放在何处？</li>
</ul>
</p>
        </div>
      </div>
    </div>
  </div>

  

    </main>
    
  

    
    <footer class="
      mt-auto p-5
      bg-dark
      text-center
      text-white
    ">
      
      <a
        href="mailto:lgqfighting@163.com"
        class="text-reset text-decoration-none"
      >lgqfighting@163.com</a>
      
      
      <div class="mt-2">
        
          <a
            class="text-reset mx-1 bg-transparent"
            href="https:&#x2F;&#x2F;chat.openai.com&#x2F;"
            title="chatGPT"
          ><i class="fab fa-glide-g"></i></a>
        
          <a
            class="text-reset mx-1 bg-transparent"
            href="https:&#x2F;&#x2F;wx.qq.com&#x2F;"
            title="微信"
          ><i class="fab fa-weixin"></i></a>
        
          <a
            class="text-reset mx-1 bg-transparent"
            href="https:&#x2F;&#x2F;www.google.com&#x2F;"
            title="谷歌"
          ><i class="fab fa-google"></i></a>
        
      </div>
      
    </footer>
    
  </body>
</html>
